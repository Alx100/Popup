/*
 * TF Popup
 * v0.9.0
 
Copyright (C) 2011  Todd Francis

This program is free software; you can redistribute it and/or
modify it under the terms of the GNU General Public License
as published by the Free Software Foundation; either version 2
of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program; if not, write to the Free Software
Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.

*/

(function(b){b.TFPopup=function(h,f){var m={modal:!1,popupWidth:null,popupHeight:null,backgroundOpacity:0.7,popupID:"tf_popup_cont",backgroundID:"tf_popup_background",loader:{content:"",ID:"tf_loader"},content:"",validationURL:"",callback:{onOpen:null,onClose:null,onError:null,onSuccess:null},inputRowClass:"form_row",invalidRowClass:"invalid_row",errorClass:"error",closeButton:{content:"Close",hidden:!1,ID:"tf_close_button"},hideFlash:!1,useMarkup:!1,markup:{top:'<div class="popup">',bottom:"</div>"},
ajaxContent:!0},a=this;a.version="0.9.0";a.settings={};var e,c,g,d;a.init=function(){a.settings=b.extend(!0,{},m,f)};a.open=function(){e=b('<div id="'+a.settings.backgroundID+'" />').appendTo(b(document.body)).css({opacity:a.settings.backgroundOpacity});c=b('<div id="'+a.settings.popupID+'" />').appendTo(b(document.body));e.click(function(b){b.preventDefault();a.settings.modal||a.close()});b(window).resize(function(){a.center()});a.settings.hideFlash&&b("object, embed").css("visibility","hidden");
e.fadeIn("fast");c.css({display:"block",opacity:0}).animate({opacity:1},"fast");g=b('<div id="'+a.settings.loader.ID+'">'+a.settings.loader.content+"</div>");c.html(g);a.center();a.settings.content?a.loadContent(a.settings.content):(window.console&&window.console.log&&console.log("No content to load"),a.close())};a.close=function(){a.settings.hideFlash&&b("object, embed").css("visibility","visible");e.fadeOut("fast",function(){e.remove();c.remove();a.settings.callback.onClose&&a.settings.callback.onClose(a)});
c.fadeOut("fast");d&&d.length>0&&d.fadeOut("fast",function(){d.remove()})};a.center=function(){var b=a.settings.popupWidth?parseInt(a.settings.popupWidth,10):c.children().outerWidth(),d=a.settings.popupHeight?parseInt(a.settings.popupHeight,10):c.children().outerHeight(),i=document.documentElement.clientHeight;c.css({top:i*0.5-d*0.5,left:document.documentElement.clientWidth*0.5-b*0.5});e.css({height:i})};a.loadContent=function(b){a.settings.ajaxContent?c.load(b,function(){j();a.center();a.settings.callback.onOpen&&
a.settings.callback.onOpen(a);k()}):(typeof a.settings.content=="string"?c.html(a.settings.content):c.html(a.settings.content.html()),j(),a.center(),k(),a.settings.callback.onOpen&&a.settings.callback.onOpen(a))};var j=function(){a.settings.useMarkup&&c.wrapInner(a.settings.markup.top+a.settings.markup.bottom);d=b('<a id="'+a.settings.closeButton.ID+'" href="#">'+a.settings.closeButton.content+"</a>");a.settings.closeButton.hidden||d.appendTo(c);d.click(function(){a.close();return!1});d.fadeIn("fast")},
n=function(b){if(typeof a.settings.validationURL=="object"&&a.settings.validationURL[b])return a.settings.validationURL[b];else if(typeof a.settings.validationURL=="string")return a.settings.validationURL;return""},l=function(b,c){if(a.settings.callback[b])if(a.settings.callback[b][c])a.settings.callback[b][c](a);else a.settings.callback[b](a)},k=function(){c.find("form").each(function(c,d){b(d).submit(function(c){c.preventDefault();var d=b(this);(c=n(d.attr("id")))?b.post(c,d.serialize(),function(c){d.find("."+
a.settings.inputRowClass).removeClass(a.settings.invalidRowClass);d.find("."+a.settings.errorClass).remove();g.remove();c.status=="error"?(c.errors&&b.each(c.errors,function(b){d.find("#"+b).parents("."+a.settings.inputRowClass).addClass(a.settings.invalidRowClass)}),d.prepend(c.feedback),l("onError",d.attr("id"))):(l("onSuccess",d.attr("id")),c.feedback&&d.before(c.feedback).remove());a.center()},"json"):window.console&&window.console.log&&console.log("No validation URL supplied")})})};a.init()};
b.fn.TFPopup=function(h){return this.each(function(){if(void 0==b(this).data("TFPopup")){var f=new b.TFPopup(this,h);b(this).data("TFPopup",f);b(this).click(function(b){b.preventDefault();f.open()})}})}})(jQuery);