/*
 * TF Popup
 * v0.9.0
 
Copyright (C) 2011  Todd Francis

This program is free software; you can redistribute it and/or
modify it under the terms of the GNU General Public License
as published by the Free Software Foundation; either version 2
of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program; if not, write to the Free Software
Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.

*/
(function(b){b.TFPopup=function(k,g){var n={modal:!1,popupWidth:null,popupHeight:null,backgroundOpacity:0.7,loader:{content:"",ID:"tf_loader"},content:"",callback:{onOpen:null,onClose:null,onError:null,onSuccess:null,onSubmit:null},closeButton:{content:"Close",hidden:!1,ID:"tf_close_button"},hideFlash:!1,useMarkup:!1,markup:{top:'<div class="popup">',bottom:"</div>",inputRowClass:"form_row",invalidRowClass:"invalid_row",errorClass:"error",popupID:"tf_popup_cont",backgroundID:"tf_popup_background"},
ajaxContent:!0,ajaxSubmit:!0},a=this;a.version="0.9.0";a.settings={};var f,c,i,d;a.init=function(){a.settings=b.extend(!0,{},n,g)};a.open=function(){f=b('<div id="'+a.settings.markup.backgroundID+'" />').appendTo(b(document.body)).css({opacity:a.settings.backgroundOpacity});c=b('<div id="'+a.settings.markup.popupID+'" />').appendTo(b(document.body));f.click(function(b){b.preventDefault();a.settings.modal||a.close()});b(window).resize(function(){a.center()});a.settings.hideFlash&&b("object, embed").css("visibility",
"hidden");f.fadeIn("fast");c.css({display:"block",opacity:0}).animate({opacity:1},"fast");i=b('<div id="'+a.settings.loader.ID+'">'+a.settings.loader.content+"</div>");c.html(i);a.center();a.settings.content?a.loadContent(a.settings.content):(j("No content to load"),a.close())};a.close=function(){a.settings.hideFlash&&b("object, embed").css("visibility","visible");f.fadeOut("fast",function(){f.remove();c.remove();a.settings.callback.onClose&&a.settings.callback.onClose(a)});c.fadeOut("fast");d&&d.length>
0&&d.fadeOut("fast",function(){d.remove()})};a.center=function(){var b=a.settings.popupWidth?parseInt(a.settings.popupWidth,10):c.children().outerWidth(),d=a.settings.popupHeight?parseInt(a.settings.popupHeight,10):c.children().outerHeight(),e=document.documentElement.clientHeight;c.css({top:e*0.5-d*0.5,left:document.documentElement.clientWidth*0.5-b*0.5});f.css({height:e})};a.loadContent=function(b,d){if(a.settings.ajaxContent&&d!==!0)c.load(b,function(){l();a.center();a.settings.callback.onOpen&&
a.settings.callback.onOpen(a);m()});else{var e;e=typeof b=="function"?b(a):b;typeof e=="string"?c.html(e):typeof e=="object"?c.html(e.html()):j("Could not parse content of type "+typeof e);l();a.center();m();a.settings.callback.onOpen&&a.settings.callback.onOpen(a)}};var l=function(){a.settings.useMarkup&&c.wrapInner(a.settings.markup.top+a.settings.markup.bottom);d=b('<a id="'+a.settings.closeButton.ID+'" href="#">'+a.settings.closeButton.content+"</a>");a.settings.closeButton.hidden||d.appendTo(c);
d.click(function(){a.close();return!1});d.fadeIn("fast")},h=function(b,c){if(a.settings.callback[b])return a.settings.callback[b][c]?a.settings.callback[b][c](a):a.settings.callback[b](a)},m=function(){c.find("form").each(function(c,d){b(d).submit(function(c){var d=b(this);h("onSubmit",d.attr("id"))!==!1?a.settings.ajaxSubmit?(c.preventDefault(),(c=d.attr("action"))?b.post(c,d.serialize(),function(c){d.find("."+a.settings.markup.inputRowClass).removeClass(a.settings.markup.invalidRowClass);d.find("."+
a.settings.markup.errorClass).remove();i.remove();c.status=="error"?(c.errors&&b.each(c.errors,function(){d.find("#"+this).parents("."+a.settings.markup.inputRowClass).addClass(a.settings.markup.invalidRowClass)}),d.prepend(c.feedback),h("onError",d.attr("id"))):(h("onSuccess",d.attr("id")),c.feedback&&d.before(c.feedback).remove());a.center()},"json"):j("No validation URL supplied")):h("onSuccess",d.attr("id")):(c.preventDefault(),h("onError",d.attr("id")))})})};a.init();var j=function(a){window.console&&
window.console.log&&console.log(a)}};b.fn.TFPopup=function(k){return this.each(function(){if(void 0==b(this).data("TFPopup")){var g=new b.TFPopup(this,k);b(this).data("TFPopup",g);g.$element=b(this);b(this).click(function(b){b.preventDefault();g.open()})}})}})(jQuery);